var heredoc = require('heredoc');
var Metrobus = require('../lib/parsers/metrobus');

// Using http://www.willpeavy.com/minifier/ to Minify
// Using heredoc found in NPM
// First start cleaning any personal data
// When specs is done, minify HTML
// heredoc is optional with minify
var html = heredoc(function() { /*
<html><head><meta http-equiv="Expires" CONTENT="0"><meta http-equiv="Cache-Control" CONTENT="no-cache"><meta http-equiv="Pragma" CONTENT="no-cache"><title>portal en linea</title><style type="text/css"><!--body{background-image: url(imagenes/bkng-page.gif);margin-left: 1px;margin-top: 1px;margin-right: 1px;margin-bottom: 1px;}--></style><link href="general/estilos.css" rel="stylesheet" type="text/css"><link href="general/modal.css" rel="stylesheet" type="text/css"><link href="general/hide_print.css" rel="stylesheet" type="text/css" media="print"><script language="javascript" src="general/utilcli.js"></script><script language="javascript" src="general/mm_menu.js"></script><script type="text/javascript" src="general/jquery.js"></script><script type="text/javascript" src="general/interface.js"></script><script language="javascript" src="general/popcalendar.js"></script></head><body><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0"><tr><td><script language="javascript"> function mnusup_onclick(shref, sitemms, sitem, accion){var oForm=document.formMenuPrincipal;oForm.target="_self";oForm.action=shref;oForm.itemms.value=sitemms;oForm.item.value=sitem;oForm.accion.value=accion;oForm.submit();}function mmLoadMenus(){var sTmp1;var sTmp2;// INICIO NUEVO CTA 20091102var sTmp3;var sTmp4;// FIN NUEVO CTA 20091102sTmp1="location='SolicitudesPortalServlet";sTmp1=sTmp1 + "?accion=9";sTmp1=sTmp1 + "&KSI=GGIIFBF19670187698931815447" + "'";sTmp2="location='SolicitudesPortalServlet";//sTmp2=sTmp2 + "?accion=10";sTmp2=sTmp2 + "?accion=1";sTmp2=sTmp2 + "&item=5";sTmp2=sTmp2 + "&KSI=GGIIFBF19670187698931815447";sTmp2=sTmp2 + "&optSeleccion=0";sTmp2=sTmp2 + "&NumTarjeta=123456" + "'";// INICIO NUEVO CTA 20091102sTmp3="location='ComercialesPortalServlet";sTmp3=sTmp3 + "?accion=2";sTmp3=sTmp3 + "&item=3";sTmp3=sTmp3 + "&itemms=0";sTmp3=sTmp3 + "&KSI=GGIIFBF19670187698931815447" + "'";sTmp4="location='ComercialesPortalServlet";sTmp4=sTmp4 + "?accion=7";sTmp4=sTmp4 + "&item=3";sTmp4=sTmp4 + "&itemms=1";sTmp4=sTmp4 + "&KSI=GGIIFBF19670187698931815447" + "'";if (window.mm_menu_0925174432_0) return;window.mm_menu_0925174432_0=new Menu("root",158,16,"Verdana, Arial, Helvetica,sans-serif",10,"#FFFFFF","#FFFFFF","F15B22","#FFCC00","left","middle",4,0,800,-5,7,true,false,true,0,true,true);//mm_menu_0925174432_0.addMenuItem("Solicitud de Servicios", sTmp1);mm_menu_0925174432_0.addMenuItem("Historial de Solicitudes", sTmp2);mm_menu_0925174432_0.hideOnMouseOut=true;mm_menu_0925174432_0.bgColor='#F15B22';mm_menu_0925174432_0.menuBorder=1;mm_menu_0925174432_0.menuLiteBgColor='#FFFFFF';mm_menu_0925174432_0.menuBorderBgColor='#FFFFFF';// INICIO NUEVO CTA 20091102//mm_menu_0925174432_0.writeMenus();window.mm_menu_0925179932_0=new Menu("root",158,16,"Verdana, Arial, Helvetica,sans-serif",10,"#FFFFFF","#FFFFFF","F15B22","#FFCC00","left","middle",4,0,800,-5,7,true,false,true,0,true,true);mm_menu_0925179932_0.addMenuItem("Resumen", sTmp3);//mm_menu_0925179932_0.addMenuItem("Carga tu tarjeta bip!", sTmp4);mm_menu_0925179932_0.hideOnMouseOut=true;mm_menu_0925179932_0.bgColor='#F15B22';mm_menu_0925179932_0.menuBorder=1;mm_menu_0925179932_0.menuLiteBgColor='#FFFFFF';mm_menu_0925179932_0.menuBorderBgColor='#FFFFFF';mm_menu_0925174432_0.writeMenus();// FIN NUEVO CTA 20091102}</script><script language="JavaScript1.2">mmLoadMenus();</script><table width="130" border="0" align="center" cellpadding="0" cellspacing="0"><tr><td><img src="imagenes/Banner-Transpanama2.png" width="863" height="79" class="hide"></td></tr><tr><td align="left" background="imagenes/bkgrnd-biplinea.gif" bgcolor="#3970B3" class="hide"><table width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td><a href="javascript:mnusup_onclick('SesionPortalServlet', '1000', '1', '6');" class="arial11-bold-blanco">Inicio</a></td><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td><a href="javascript:mnusup_onclick('ComercialesPortalServlet', '2000', '1', '6');" class="arial11-bold-blanco">Resumen</a></td><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td><a href="javascript:mnusup_onclick('ComercialesPortalServlet', '3000', '2', '1');" class="arial11-bold-blanco">Saldo y Movimientos</a></td><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td><a href="#" name="link2" class="arial11-bold-blanco" id="link2" onMouseOver="MM_showMenu(window.mm_menu_0925179932_0,-10,20,null,'link2')" onMouseOut="MM_startTimeout();">Carga Remota</a></td><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td><a href="javascript:mnusup_onclick('ComercialesPortalServlet', '5000', '4', '4');" class="arial11-bold-blanco">Convenios</a></td><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td><a href="#" name="link3" class="arial11-bold-blanco" id="link1" onMouseOver="MM_showMenu(window.mm_menu_0925174432_0,-10,20,null,'link3')" onMouseOut="MM_startTimeout();">Servicio al Cliente</a></td><td><a href="javascript:mnusup_onclick('SolicitudesPortalServlet', '6000', '7', '13');" class="arial11-bold-blanco">Bloquear Tarjeta</a></td><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td align="center"><table border="0" cellspacing="0" cellpadding="0"><tr><td><img src="imagenes/separador-biplinea.gif" width="19" height="25"></td><td align="right" valign="middle"><a href="javascript:mnusup_onclick('SesionPortalServlet', '8000', '0', '9');"><img src="imagenes/closelabel.jpg" border="0"></a></td></tr></table></td></tr></table></td></tr></table><form id="formMenuPrincipal" name="formMenuPrincipal" action="" target="_self" method="get"><input type="hidden" id="KSI" name="KSI" value="GGIIFBF19670187698931815447"><input type="hidden" id="accion" name="accion" value=""><input type="hidden" id="itemms" name="itemms" value=""><input type="hidden" id="item" name="item" value="0"><input type="hidden" id="fechalogeo"name="fechalogeo"value="20130825224246"><input type="hidden" id="DiasMov" name="DiasMov" value="90"><input type="hidden" id="FechaInicioMovimientos"name="FechaInicioMovimientos"value=""></form></td></tr><tr><td><table width="874" border="0" align="center" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF"><tr><td width="13" background="imagenes/box01.gif"><img src="imagenes/5x5.gif" width="13" height="13"/></td><td><table width="100%" border="0" cellspacing="0" cellpadding="2"><form id="formPrincipal" name="formPrincipal" action="SesionPortalServlet" target="_top" method="post"><input type="hidden" id="NumTarjeta"name="NumTarjeta"value="123456"><input type="hidden" id="RutUsuario"name="RutUsuario"value="0"><input type="hidden" id="KSI" name="KSI" value="GGIIFBF19670187698931815447"><input type="hidden" id="accion" name="accion" value=""><input type="hidden" id="itemms" name="itemms" value=""><input type="hidden" id="item" name="item" value="0"><tr><td bgcolor="#FFFFFF"><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0"><tr><td height="45"><table border="0" cellspacing="0" cellpadding="0"><tr><td align="center"><img src="imagenes/bullet-big.gif" width="16" height="23"></td><td><img src="imagenes/titu-resumen.gif" width="207" height="24"></td></tr></table></td></tr><tr><td align="left"><span class="arial1-azul">* El saldo indicado corresponde a la fecha indicada.</span></td></tr><tr><td><br><span class="arial12-bold-azul">Tipo de contrato: Monedero</span><br><br><table width="70%" border="0" align="center" cellspacing="0" cellpadding="0" bgcolor="#F15B22"><tr><td><table width="100%" border="0" align="center" cellpadding="3" cellspacing="1"><tr><td width="24%" bgcolor="#FFFFFF" class="verdanabold-ckc">Nºtarjeta:</td><td width="24%" bgcolor="#F15B22" class="verdanabold-ckc">123456</td><td width="23%" bgcolor="#FFFFFF" class="verdanabold-ckc">Estado de contrato: </td><td width="21%" bgcolor="#F15B22" class="verdanabold-ckc">Contrato Activo</td></tr><tr><td bgcolor="#FFFFFF" class="verdanabold-ckc">Saldo tarjeta:</td><td bgcolor="#F15B22" class="verdanabold-ckc">3.25</td><td bgcolor="#FFFFFF" class="verdanabold-ckc">Fecha saldo: </td><td bgcolor="#F15B22" class="verdanabold-ckc">19/07/2013 15:09</td></tr></table></td></tr></table><br></td></tr></table><script type="text/JavaScript"><!--function MM_preloadImages(){//v3.0var d=document;if(d.images){if(!d.MM_p) d.MM_p=new Array();var i,j=d.MM_p.length,a=MM_preloadImages.arguments;for(i=0;i<a.length;i++) if (a[i].indexOf("#")!=0){d.MM_p[j]=new Image;d.MM_p[j++].src=a[i];}}}//--></script><style type="text/css"><!--body{margin-left: 2px;margin-top: 2px;margin-right: 2px;margin-bottom: 2px;background-image: url(imagenes/bkng-page.gif);}--></style><link href="general/estilos.css" rel="stylesheet" type="text/css"><style type="text/css"><!--.style2{color: 0C2577;text-decoration: none;font-weight: normal;}--></style></td></tr></form></table><br></td><td width="13" background="imagenes/box05.gif"><img src="imagenes/5x5.gif" width="13" height="13"/></td></tr><tr><td valign="top"><img src="imagenes/box02.gif" width="13" height="13"/></td><td background="imagenes/box03.gif"> </td><td align="right" valign="top"><img src="imagenes/box04.gif" width="13" height="13"/></td></tr></table></body></html></td></tr></table>
*/});

describe("Metrobus spec", function() {
  it("when html from an card id post, should return a model", function() {
    var metrobusService = new Metrobus("123456");
    var matchWith = {
      cardId: '123456',
      status: 'Contrato Activo',
      balance: '3.25',
      lastTransactionAt: '19/07/2013 15:09'
    };
    expect(metrobusService.parse(html)).toEqual(matchWith);
  });
});